#cloud-config
output: {all: "| tee -a /var/log/cloud-init-output.log"}
final_message: "The system is up, after $UPTIME seconds"

disable_root: true
disable_root_opts: no-port-forwarding,no-agent-forwarding,no-X11-forwarding



ssh_pwauth: true
ssh_deletekeys: true
ssh_quiet_keygen: true
no_ssh_fingerprints: false
ssh_genkeytypes: [rsa, ecdsa, ed25519]
ssh_publish_hostkeys:
  blacklist: [rsa]
  enabled: true
ssh:
  emit_keys_to_console: false

locale: C.UTF-8
timezone: Etc/UTC
keyboard:
  layout: de

hostname: myhost
fqdn: myhost.mydomain
create_hostname_file: true
prefer_fqdn_over_hostname: true



package_update: true
package_upgrade: true
package_reboot_if_required: true

apt:
  conf: |
    binary::apt::DPkg::Lock::Timeout 180;
    APT::Install-Suggests 0;
    APT::NeverAutoRemove 0;
    APT::Get::Update 1;
    APT::Get::Assume-Yes 1;
    APT::Get::Fix-Broken 1;
    APT::Get::Install-Recommends 0;
  primary:
    - arches: [default]
      search_dns: True
  security:
    - arches: [default]
      search_dns: True
  sources:
    docker:
      source: deb [signed-by=$KEY_FILE] https://download.docker.com/linux/ubuntu $RELEASE stable
      keyid: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88

packages:
  - qemu-guest-agent
  - apt-transport-https
  - software-properties-common
  - sudo
  - wget
  - curl
  - whois
  - psmisc
  - dnsutils
  - net-tools
  - iputils-ping
  - gnupg
  - lsb-release
  - openssh-server
  - ca-certificates
  - vim
  - nano
  - git
  - git-lfs
  - docker-ce



groups:
  - docker

users:
  - name: myuser
    primary_group: myuser
    lock_passwd: false
    plain_text_passwd: mypassword
    groups: sudo, users, docker
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash



write_files:
  - path: /etc/sysctl.d/99-ipv4-forwarding.conf
    content: |
      # This file was generated by cloud-init

      net.ipv4.conf.all.forwarding = 1

  - path: /etc/default/halt
    owner: root:root
    permissions: "0644"
    content: |
      # This file was generated by cloud-init

      # Default behaviour of shutdown -h / halt. Set to "halt" or "poweroff".
      HALT=poweroff
